<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ljq.demo.springboot.dao.article.ArticleDao">

	<!-- 文章表结果集resultMap -->
    <resultMap type="com.ljq.demo.springboot.entity.ArticleEntity" id="articleMap">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
		<collection property="tagList" column="id" javaType="java.util.List" ofType="com.ljq.demo.springboot.entity.ArticleTagEntity"
					select="com.ljq.demo.springboot.dao.article.ArticleTagDao.queryTagsByArticleId">
			<id property="id" column="id" />
			<result property="tagName" column="tag_name" />
		</collection>
    </resultMap>

   <!-- 文章表-基础字段 -->
	<sql id="article_base_field">
        a.`id`,
        a.`title`,
        a.`content`
	</sql>

	<!-- 文章表-列表字段 -->
	<sql id="article_list_field">
        <include refid="article_base_field" />
        ,
        at.`id` at_id,
        at.`tag_name` at_tag_name
	</sql>

	<!-- 列表查询 -->
	<select id="queryListPage" parameterType="java.util.Map" resultMap="articleMap">
		SELECT
		<include refid="article_base_field" />
		FROM article a
		LEFT JOIN `article_to_tag` att ON att.article_id = a.id
		LEFT JOIN `article_tag` at ON at.id = att.tag_id
		WHERE 1 = 1
		<if test="title != null and '' != title">
			AND a.title LIKE CONCAT(CONCAT("%", #{title}), "%")
		</if>
		<if test="articleTag != null and '' != articleTag">
			AND at.tag_name LIKE CONCAT(CONCAT("%", #{articleTag}), "%")
		</if>
		GROUP BY a.id
	</select>



</mapper>